/**
 *
 * @package   theme_mb2nl
 * @copyright 2017 - 2025 Mariusz Boloz (lmsstyle.com)
 * @license   PHP and HTML: http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later. Other parts: http://themeforest.net/licenses
 */ define(["jquery","theme_mb2nl/userpreference","theme_mb2nl/morelessbtn","core/ajax","theme_mb2nl/toc","theme_mb2nl/str"],function(t,e,s,a,n,o){"use strict";var d=function(){t(document).on("click",".tgsdb_btn",function(){t("body").hasClass("tgsdb_open")?(t("body").removeClass("tgsdb_open"),t(this).attr("aria-expanded","false"),t(this).find(".sr-only").html(o.get_str("tgsdbopen")),e.sePreference("mb2_tgsdb",0),i()):(t("body").addClass("tgsdb_open"),t(this).attr("aria-expanded","true"),t(this).find(".sr-only").html(o.get_str("tgsdbclose")),e.sePreference("mb2_tgsdb",1)),t("body").hasClass("tgsdb_mopen")?(t("body").removeClass("tgsdb_mopen"),i()):t("body").addClass("tgsdb_mopen"),b(),r()}),t(document).on("click",".tgsdbb_toggle",function(){t(this).attr("aria-expanded","false"),i()}),t(document).on("click",".tgsdb-btn",function(){var a=t(this).attr("data-id"),o=t(this).attr("aria-controls");t(this).hasClass("active")?i():(t(".tgsdb-btn").removeClass("active"),t(".tgsdb-btn").attr("aria-expanded","false"),t(".tgsdb-section").removeClass("active"),t(".toggle-sidebar").attr("data-tgsdb_active",a),t("body").addClass("tgsdbb_open"),t(this).addClass("active"),t(this).attr("aria-expanded","true"),t("#"+o).addClass("active"),t(".tgsdbb_toggle").attr("aria-expanded","true"),t(".tgsdbb_toggle").attr("aria-controls",o),"chome"===a&&(s.init(),l()),"toc"===a&&n.courseTocScroll(),b(),e.sePreference("mb2_tgsdbactv",a),e.sePreference("mb2_tgsdbb",1))}),g(),setTimeout(function(){b(),r()},50),t(window).on("scroll",function(){g(),b(),r()}),t(window).on("resize",function(){g(),b(),r()}),t(".tgsdb-links").on("scroll",function(){r()})};let r=()=>{t(".tgsdb-links .item-link, .tgsdb-btn").each(function(){let e=t(this).find(".text"),s=t(this).offset().top-t(window).scrollTop()+t(this).outerHeight(!0)/2-e.outerHeight(!0)/2;e.css("top",s)})},i=()=>{t("body").removeClass("tgsdbb_open"),t(".tgsdb-btn").removeClass("active"),t(".tgsdb-section").removeClass("active"),t(".tgsdb-btn").attr("aria-expanded","false"),t(".tgsdbb_toggle").attr("aria-expanded","false"),t(".tgsdbb_toggle").attr("aria-controls",""),e.sePreference("mb2_tgsdbactv","none"),e.sePreference("mb2_tgsdbb",0)},b=()=>{let e=t(".sidebar-content"),s=e.find(".sidebar-tabs-list").height(),a=e.find(".sidebar-footer").outerHeight(),n=e.closest(".toggle-sidebar").width()-e.width();n>0&&e.find(".sidebar-tabs-content").css("max-width",n),e.find(".sidebar-menu").css("height",e.height()-s-a)},l=()=>{t(".nonamdlightboxtrigger").length||t("body").append('<button type="button" class="nonamdlightboxtrigger" style="display:none;"></button>'),t(".nonamdlightboxtrigger").click()};var g=function(){if(!t("body").hasClass("tgsdb"))return null;var e=t("#fsmod-header").length?t("#fsmod-header"):t(".header-inner2"),s=t(window).width(),a=!t("body").hasClass("fsmod1")&&(t("body").hasClass("theme-lfx")||t("body").hasClass("theader_transparent")||t("body").hasClass("theader_transparent_light")),n=e.offset().top,o=t("#fsmod-header").length?e.outerHeight():e.outerHeight()+n,d=s<=991&&!t("body").hasClass("eopn1")?0:mb2nljs.headerhsm,r=t(".toggle-sidebar"),i=t(window).scrollTop();a&&(o=t(".sliding-panel").length?t(".sliding-panel").outerHeight():0,d=0);var b=Math.ceil(o-i)>d?Math.ceil(o-i):d;r.css("--tgsdb_cheight",b+"px")};let c=e=>{var n;let o=t(".course-sidebar-home");(n=e,a.call([{methodname:"theme_mb2nl_course_chome",args:{courseid:n}}])[0]).then(t=>{o.append(t.chome),s.init(),l()}).catch(t=>{require(["core/log"],function(e){e.debug(t)})})};return{init:d,tgsdbTopPos:g,loadChome:c}});